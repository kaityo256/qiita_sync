# Qiitaに書いた記事をGitHub用にダウンロードするスクリプト

## 概要

Qiitaに投稿した記事を、GitHub用にダウンロードしてSyncします。Qiitaからデータを取ってくるスクリプトと、取ってきたデータを見てローカルデータを更新するスクリプトの２つがあります。

* `qiita_get.rb` Qiitaからデータを取ってくるRubyスクリプトです。中身の`$USER`をご自身のIDに変えて使ってください。アクセストークンを`QIITA_TOKEN`という名前の環境変数で与えておく必要があります。実行すると、`qiita.yaml`というファイルを作ります。また、デバッグ用に`qiita?.json`というファイルも吐きます。
* `sync.rb` `qiita.yaml`とローカルファイルの状況を見て、ローカルファイルの更新をします。

## 使い方

まずデータを取ってきます。

```sh
ruby qiita_get.rb
```

すると、Qiitaの「全データ」が`qiita.yaml`というファイルに保存されます。なお、100本以上の記事がある場合は何回かにわけて保存します。保存のたびに受け取ったデータを`qiita?.json`というファイルに保存します。

次に、syncスクリプトを走らせます。

```sh
ruby sync.rb
```

このファイルは、`dirlist.yaml`というYAMLファイルを見て、記事のタイトルとディレクトリを関連付けます。もしファイルが無ければ初回実行時に作られます。こんなファイルになります。

```yaml
---
Pythonでフーリエ変換:
822823回マクロを展開するとGCCが死ぬ:
WindowsのVSCodeで__m256d型のインデックスアクセスにenumを使うと怒られる:
```

これはタイトルとディレクトリを結びつけるハッシュです。そこでディレクトリ名を指定すると、そのディレクトリに記事を展開します。例えば「Pythonでフーリエ変換」という記事を`python_fft`というディレクトリに保存したいなら

```yaml
---
Pythonでフーリエ変換: python_fft
```

とします。この状態で`sync.rb`を実行してみます。

```sh
$ ruby sync.rb
Create direcotry python_fft
https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/79744/1551cc23-899c-089b-2335-1ab9700008f3.png
.png
(snip)
4-f517-bea7-4bba14ff5a37.png to python_fft/image13.png
Updated 1 article(s).
```

ディレクトリが無ければ作り、あれば`README.md`のタイムスタンプと記事のタイムスタンプを比較し、古ければ上書きします。イメージは「image?.拡張子」という名前でダウンロードします。記事名にディレクトリが指定されていなければ無視されますので、一つ一つ指定しては`sync.rb`を走らせてみると良いと思います。

以後、`qiita_get.rb`、`sync.rb`を実行すれば差分を更新してくれるはずです。

## QiitaとGitHubのMarkdown方言について

QiitaとGitHubのMarkdownはやや違います。このスクリプトは、見出しの変換と数式の変換だけします。

Qiitaでは

```md
# 節1
...
# 節2
...
```

のように、レベル1の見出しを並べるのが一般的だと思います(多分)。しかしこのままでは、markdownlintが怒るので、

```md
# タイトル
...
## 節1
...
## 節2
...
```

のように、レベル1でタイトル、残りは一個ずつレベルを下げます。

数式は、`math`で指定されたものを`$$`に変換します。さらに`\begin{align}`を`\begin{aligned}`に変換します。これは私がVSCodeのプレビューでそっちを使っている都合です。

それ以外は全く変換しないので、凝ったこと(表とか)をしているとバグるかもしれません。ご利用は自己責任でどうぞ。

## ライセンス

MIT
